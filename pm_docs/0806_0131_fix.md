# Work Log: Fix Nested Anchor Tags in MDX

**Date**: 2025-08-06 01:31  
**Type**: Bug Fix  
**Project**: deeptoai

## Summary

Fixed React hydration error caused by nested anchor tags in MDX content. The issue occurred when heading elements contained links, causing invalid HTML structure and hydration failures.

## Work Process

1. **Issue Analysis**
   - Identified hydration error in browser console
   - Error message: "In HTML, `<a>` cannot be a descendant of `<a>`"
   - Located the problem in `/docs/zh/tools/` page

2. **Root Cause Investigation**
   - Found that MDX headings with links inside were causing nested anchors
   - The heading component auto-generates anchor links for IDs
   - When a heading contains a link, it creates nested `<a>` tags

3. **Solution Implementation**
   - Modified MDX content structure in both Chinese and English versions
   - Changed from: `### [Link Text](url)` 
   - Changed to: `### Plain Text` followed by `[View Details](url)`
   - This prevents links from being inside heading elements

## Results

### Files Modified
1. `/Users/peng/Dev/Projects/deeptoai/content/docs/zh/tools/index.mdx`
   - Restructured 4 heading sections to avoid nested links
   - Moved links outside of heading elements

2. `/Users/peng/Dev/Projects/deeptoai/content/docs/en/tools/index.mdx`
   - Applied same restructuring to English version
   - Fixed Chinese text that appeared in English documentation
   - Replaced "敷衍性回复" with "perfunctory responses"

### Before/After Example
**Before** (causing nested anchors):
```markdown
### [防止"你是对的"敷衍回复 Hook](/docs/zh/tools/you-are-not-right-hook)
```

**After** (fixed):
```markdown
### 防止"你是对的"敷衍回复 Hook
[查看详情](/docs/zh/tools/you-are-not-right-hook)
```

## Next Steps

1. **Immediate Actions**
   - Rebuild the project after clearing cache
   - Test the hydration fix in development environment
   - Verify no other pages have similar issues

2. **Preventive Measures**
   - Create documentation guideline about heading structure
   - Consider adding a linter rule to prevent links in headings
   - Review other MDX files for similar patterns

3. **Additional Improvements**
   - Could create a custom heading component that handles this case
   - Consider using a different link structure for tool listings
   - Possibly implement a card-based layout instead of heading-based

## Notes

- The issue was specific to Fumadocs UI's heading component implementation
- The `createRelativeLink` function from Fumadocs was contributing to the issue
- Multiple Next.js dev server instances were running, requiring cleanup
- The fix maintains visual appearance while solving the technical issue

## Technical Details

The hydration error occurred because:
1. Fumadocs auto-generates anchor links for heading IDs
2. When a heading contains a link, it results in `<a><a>...</a></a>` structure
3. This is invalid HTML and causes React hydration to fail
4. The browser console showed detailed component stack trace pointing to the issue

Solution maintains the same visual layout but separates the concerns:
- Headings provide structure and auto-anchors
- Links are placed immediately after headings for navigation
